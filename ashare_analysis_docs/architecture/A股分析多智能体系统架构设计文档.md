# Aè‚¡åˆ†æå¤šæ™ºèƒ½ä½“ç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£
**Technical Architecture Design: A-Share Analysis Multi-Agent System**

---

## 1. æ¶æ„è®¾è®¡æ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡
åŸºäºç°æœ‰TradingAgents-CNæ¡†æ¶ï¼Œè®¾è®¡å¹¶å®ç°ä¸“ä¸šåŒ–çš„Aè‚¡åˆ†æå¤šæ™ºèƒ½ä½“ç³»ç»Ÿï¼Œé€šè¿‡å››ä¸ªæ ¸å¿ƒAgentåä½œï¼Œä¸ºAè‚¡æŠ•èµ„è€…æä¾›å…¨é¢ã€æ·±åº¦çš„è‚¡ç¥¨åˆ†ææœåŠ¡ã€‚

### 1.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ–°å»ºanalysis_stock_agentæ¨¡å—ï¼Œæ— ç¼é›†æˆåˆ°ç°æœ‰æ¶æ„
- **æ‰©å±•æ€§åŸåˆ™**ï¼šæ”¯æŒæœªæ¥æ›´å¤šè´¢åŠ¡åˆ†æåŠŸèƒ½çš„æ‰©å±•
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé’ˆå¯¹è´¢åŠ¡æ•°æ®å¯†é›†å‹åˆ†æçš„æ€§èƒ½è€ƒè™‘
- **æˆæœ¬æ§åˆ¶**ï¼šä¼˜åŒ–LLMè°ƒç”¨å’Œæ•°æ®è·å–æˆæœ¬
- **å¯ç»´æŠ¤æ€§**ï¼šæ¸…æ™°çš„ä»£ç ç»„ç»‡å’Œä¾èµ–å…³ç³»

### 1.3 æŠ€æœ¯çº¦æŸ
- åŸºäºç°æœ‰LangGraphå¤šæ™ºèƒ½ä½“æ¡†æ¶
- ä½¿ç”¨è‡ªå®šä¹‰OpenAPI endpoint + Ollamaå¤‡ç”¨çš„LLMç­–ç•¥
- é‡‡ç”¨Tushareä¸»è¦ + AkShareå¤‡ç”¨çš„æ•°æ®æºç­–ç•¥
- æ”¯æŒç°æœ‰çš„MongoDB + Redisç¼“å­˜æ¶æ„
- ä¿æŒä¸ç°æœ‰Web/CLIç•Œé¢çš„å…¼å®¹æ€§

---

## 2. æ•´ä½“ç³»ç»Ÿæ¶æ„

### 2.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ·æ¥å£å±‚ (Interface Layer)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Streamlit Web UI  â”‚  CLI Interface  â”‚  API Endpoints         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ç¼–æ’å±‚ (Orchestration Layer)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              LangGraph Multi-Agent Framework                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ç°æœ‰Trading    â”‚  â”‚  æ–°å¢ Aè‚¡åˆ†ææ¨¡å—                      â”‚ â”‚
â”‚  â”‚  Agents Graph   â”‚  â”‚  analysis_stock_agent                â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                                     â”‚ â”‚
â”‚  â”‚ â€¢ Analysts      â”‚  â”‚ â€¢ FinancialMetricsAgent             â”‚ â”‚
â”‚  â”‚ â€¢ Researchers   â”‚  â”‚ â€¢ IndustryComparisonAgent           â”‚ â”‚
â”‚  â”‚ â€¢ Managers      â”‚  â”‚ â€¢ ValuationAnalysisAgent            â”‚ â”‚
â”‚  â”‚ â€¢ Trader        â”‚  â”‚ â€¢ ReportIntegrationAgent            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   LLMå±‚ (LLM Layer)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è‡ªå®šä¹‰OpenAPI    â”‚  Ollamaæœ¬åœ°      â”‚  DashScope/DeepSeek    â”‚
â”‚  Endpoint (ä¸»)    â”‚  æ¨¡å‹ (å¤‡)       â”‚  (ç°æœ‰æ”¯æŒ)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•°æ®å±‚ (Data Layer)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ç°æœ‰æ•°æ®æº     â”‚  â”‚  Aè‚¡ä¸“ç”¨æ•°æ®æºå¢å¼º                      â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                                     â”‚ â”‚
â”‚  â”‚ â€¢ FinnHub       â”‚  â”‚ â€¢ Tushare Pro (ä¸»è¦)                â”‚ â”‚
â”‚  â”‚ â€¢ Yahoo Finance â”‚  â”‚ â€¢ AkShare (å¤‡ç”¨)                    â”‚ â”‚
â”‚  â”‚ â€¢ Reddit        â”‚  â”‚ â€¢ è¡Œä¸šåˆ†ç±»æ•°æ®                        â”‚ â”‚
â”‚  â”‚ â€¢ Google News   â”‚  â”‚ â€¢ è´¢åŠ¡æŠ¥è¡¨æ•°æ®                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å­˜å‚¨å±‚ (Storage Layer)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  MongoDB        â”‚  Redis Cache    â”‚  ChromaDB      â”‚  File    â”‚
â”‚  (æ–‡æ¡£å­˜å‚¨)      â”‚  (çƒ­æ•°æ®ç¼“å­˜)    â”‚  (å‘é‡å­˜å‚¨)     â”‚  Cache   â”‚
â”‚                 â”‚                 â”‚  (å¯é€‰)        â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ¶æ„ç‰¹ç‚¹
- **æ— ä¾µå…¥å¼é›†æˆ**ï¼šæ–°æ¨¡å—ä½œä¸ºç‹¬ç«‹çš„analysis_stock_agentæ·»åŠ ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½
- **å…±äº«åŸºç¡€è®¾æ–½**ï¼šå¤ç”¨ç°æœ‰çš„LLMå±‚ã€æ•°æ®å±‚ã€å­˜å‚¨å±‚
- **æ•°æ®æºå¢å¼º**ï¼šä¸“é—¨ä¸ºAè‚¡åˆ†æä¼˜åŒ–æ•°æ®æºé…ç½®
- **æ¨¡å—åŒ–è®¾è®¡**ï¼š4ä¸ªä¸“ä¸šAgentå¯ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•

---

## 3. è¯¦ç»†æ¨¡å—è®¾è®¡

### 3.1 analysis_stock_agentæ¨¡å—æ¶æ„

```
tradingagents/
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ analysts/          # ç°æœ‰åˆ†æå¸ˆ
â”‚   â””â”€â”€ a_share_analysts/  # æ–°å¢Aè‚¡ä¸“ç”¨åˆ†æå¸ˆ
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ base_ashare_analyst.py      # Aè‚¡åˆ†æå¸ˆåŸºç±»
â”‚       â”œâ”€â”€ financial_metrics_agent.py   # è´¢åŠ¡æŒ‡æ ‡åˆ†æAgent
â”‚       â”œâ”€â”€ industry_comparison_agent.py # è¡Œä¸šå¯¹æ¯”åˆ†æAgent
â”‚       â”œâ”€â”€ valuation_analysis_agent.py  # ä¼°å€¼åˆ†æAgent
â”‚       â””â”€â”€ report_integration_agent.py  # æŠ¥å‘Šæ•´åˆAgent
â”œâ”€â”€ dataflows/
â”‚   â”œâ”€â”€ ashare_data/       # æ–°å¢Aè‚¡æ•°æ®å¤„ç†
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ ashare_data_source.py       # Aè‚¡æ•°æ®æºç®¡ç†
â”‚   â”‚   â”œâ”€â”€ financial_data_processor.py # è´¢åŠ¡æ•°æ®å¤„ç†
â”‚   â”‚   â”œâ”€â”€ industry_data_processor.py  # è¡Œä¸šæ•°æ®å¤„ç†
â”‚   â”‚   â””â”€â”€ valuation_data_processor.py # ä¼°å€¼æ•°æ®å¤„ç†
â”œâ”€â”€ graph/
â”‚   â””â”€â”€ ashare_analysis_graph.py        # Aè‚¡åˆ†æå›¾ç»“æ„
â”œâ”€â”€ tools/
â”‚   â””â”€â”€ ashare_tools/      # æ–°å¢Aè‚¡ä¸“ç”¨å·¥å…·
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ financial_metrics_tools.py
â”‚       â”œâ”€â”€ industry_comparison_tools.py
â”‚       â””â”€â”€ valuation_analysis_tools.py
â””â”€â”€ utils/
    â””â”€â”€ ashare_utils/      # æ–°å¢Aè‚¡åˆ†æå·¥å…·
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ financial_calculator.py     # è´¢åŠ¡è®¡ç®—å™¨
        â”œâ”€â”€ industry_classifier.py      # è¡Œä¸šåˆ†ç±»å™¨
        â””â”€â”€ report_generator.py         # æŠ¥å‘Šç”Ÿæˆå™¨
```

### 3.2 æ ¸å¿ƒAgentç±»è®¾è®¡

#### 3.2.1 BaseAShareAnalyståŸºç±»
```python
class BaseAShareAnalyst:
    """Aè‚¡åˆ†æAgentåŸºç±»"""
    
    def __init__(self, llm, config, data_sources):
        self.llm = llm
        self.config = config
        self.data_sources = data_sources
        self.cache_manager = AShareCacheManager()
    
    def analyze(self, ticker: str, analysis_date: str) -> Dict:
        """æ ¸å¿ƒåˆ†ææ–¹æ³•"""
        # 1. è¾“å…¥éªŒè¯
        self.validate_ticker(ticker)
        
        # 2. æ•°æ®è·å–
        data = self.get_analysis_data(ticker, analysis_date)
        
        # 3. å…·ä½“åˆ†æï¼ˆå­ç±»å®ç°ï¼‰
        result = self.perform_analysis(data)
        
        # 4. ç»“æœéªŒè¯å’Œç¼“å­˜
        self.validate_result(result)
        self.cache_result(ticker, analysis_date, result)
        
        return result
    
    def validate_ticker(self, ticker: str) -> bool:
        """Aè‚¡ä»£ç éªŒè¯"""
        import re
        pattern = r'^[0-9]{6}$'
        if not re.match(pattern, ticker):
            raise ValueError(f"æ— æ•ˆçš„Aè‚¡ä»£ç æ ¼å¼: {ticker}")
        return True
    
    def get_company_info(self, ticker: str) -> Dict:
        """è·å–å…¬å¸åŸºæœ¬ä¿¡æ¯"""
        pass
```

#### 3.2.2 çŠ¶æ€ç®¡ç†è®¾è®¡
```python
class AShareAnalysisState(TypedDict):
    """Aè‚¡åˆ†æçŠ¶æ€å®šä¹‰"""
    # è¾“å…¥å‚æ•°
    ticker: str              # è‚¡ç¥¨ä»£ç 
    analysis_date: str       # åˆ†ææ—¥æœŸ
    analysis_config: Dict    # åˆ†æé…ç½®
    
    # å…¬å¸åŸºç¡€ä¿¡æ¯
    company_info: Dict       # å…¬å¸åŸºæœ¬ä¿¡æ¯
    industry_info: Dict      # è¡Œä¸šä¿¡æ¯
    
    # Agentåˆ†æç»“æœ
    financial_metrics: Dict      # è´¢åŠ¡æŒ‡æ ‡åˆ†æ
    industry_comparison: Dict    # è¡Œä¸šå¯¹æ¯”åˆ†æ
    valuation_analysis: Dict     # ä¼°å€¼åˆ†æ
    integration_report: str      # æ•´åˆæŠ¥å‘Š
    
    # æ‰§è¡Œæ§åˆ¶
    current_agent: str           # å½“å‰æ‰§è¡ŒAgent
    completed_agents: List[str]  # å·²å®ŒæˆAgentåˆ—è¡¨
    error_messages: List[str]    # é”™è¯¯ä¿¡æ¯åˆ—è¡¨
    
    # æœ€ç»ˆè¾“å‡º
    investment_recommendation: str  # æŠ•èµ„å»ºè®®
    confidence_score: float        # ç½®ä¿¡åº¦è¯„åˆ†
    risk_warnings: List[str]       # é£é™©æç¤º
```

---

## 4. Agentäº¤äº’æµç¨‹è®¾è®¡

### 4.1 Agentåä½œæœºåˆ¶

```
ç”¨æˆ·è¾“å…¥è‚¡ç¥¨ä»£ç  â†’ è‚¡ç¥¨ä»£ç éªŒè¯ â†’ å…¬å¸åŸºæœ¬ä¿¡æ¯è·å–
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•°æ®å¹¶è¡Œé‡‡é›†é˜¶æ®µ                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ è´¢åŠ¡æ•°æ®é‡‡é›† â”‚  â”‚ è¡Œä¸šæ•°æ®é‡‡é›† â”‚  â”‚ å¸‚åœºæ•°æ®é‡‡é›† â”‚          â”‚
â”‚  â”‚ (3å¹´å†å²)   â”‚  â”‚ (åŒè¡Œä¸šå…¬å¸) â”‚  â”‚ (ä¼°å€¼æŒ‡æ ‡)   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Agentå¹¶è¡Œåˆ†æé˜¶æ®µ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚FinancialMetrics â”‚  â”‚ IndustryComparison Agent            â”‚ â”‚
â”‚  â”‚Agent            â”‚  â”‚                                     â”‚ â”‚
â”‚  â”‚â€¢ ROEå¥åº·åº¦åˆ†æ   â”‚  â”‚ â€¢ è¡Œä¸šè¯†åˆ«ä¸åˆ†ç±»                      â”‚ â”‚
â”‚  â”‚â€¢ èµ„äº§è´Ÿå€ºåˆ†æ    â”‚  â”‚ â€¢ è¡Œä¸šå¹³å‡æŒ‡æ ‡å¯¹æ¯”                    â”‚ â”‚
â”‚  â”‚â€¢ ç°é‡‘æµåˆ†æ     â”‚  â”‚ â€¢ å¤´éƒ¨ä¼ä¸šç«äº‰åŠ›å¯¹æ¯”                   â”‚ â”‚
â”‚  â”‚â€¢ è‚¡ä¸œå›æŠ¥åˆ†æ    â”‚  â”‚ â€¢ å¸‚åœºä»½é¢åˆ†æ                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                        â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ValuationAnalysis Agent                                  â”‚ â”‚
â”‚  â”‚ â€¢ è‚¡æƒå˜åŠ¨å¼‚å¸¸åˆ†æ                                         â”‚ â”‚
â”‚  â”‚ â€¢ è‚¡ä¸œç»“æ„ç‰¹ç‚¹åˆ†æ                                         â”‚ â”‚
â”‚  â”‚ â€¢ PEGä¼°å€¼åˆ†æ                                            â”‚ â”‚
â”‚  â”‚ â€¢ ç›®æ ‡ä»·ä½è®¡ç®—                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç»“æœæ•´åˆé˜¶æ®µ                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ReportIntegration Agent                                  â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚ â€¢ é‡‘å­—å¡”åŸç†ç»“æ„åŒ–æŠ¥å‘Š                                     â”‚ â”‚
â”‚  â”‚ â€¢ æŠ•èµ„å»ºè®®ç»¼åˆè¯„åˆ†                                        â”‚ â”‚
â”‚  â”‚ â€¢ æ•°æ®æ¥æºæ ‡æ³¨                                           â”‚ â”‚
â”‚  â”‚ â€¢ é£é™©å› ç´ è¯†åˆ«                                           â”‚ â”‚
â”‚  â”‚ â€¢ æœ€ç»ˆæŠ•èµ„å»ºè®®ç”Ÿæˆ                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
                    æœ€ç»ˆæŠ¥å‘Šè¾“å‡º (PDF/Webå±•ç¤º)
```

### 4.2 LangGraphå®ç°
```python
class AShareAnalysisGraph:
    def __init__(self, llm, config, toolkit):
        self.llm = llm
        self.config = config
        self.toolkit = toolkit
        self.graph = self._build_graph()
    
    def _build_graph(self):
        """æ„å»ºAè‚¡åˆ†æä¸“ç”¨çš„LangGraph"""
        from langgraph.graph import StateGraph, START, END
        
        workflow = StateGraph(AShareAnalysisState)
        
        # æ·»åŠ èŠ‚ç‚¹
        workflow.add_node("financial_metrics", self._create_financial_agent())
        workflow.add_node("industry_comparison", self._create_industry_agent())
        workflow.add_node("valuation_analysis", self._create_valuation_agent())
        workflow.add_node("report_integration", self._create_integration_agent())
        
        # å®šä¹‰æ‰§è¡Œæµç¨‹
        workflow.add_edge(START, "financial_metrics")
        workflow.add_edge(START, "industry_comparison")  # å¹¶è¡Œæ‰§è¡Œ
        workflow.add_edge("financial_metrics", "valuation_analysis")
        workflow.add_edge("industry_comparison", "valuation_analysis")
        workflow.add_edge("valuation_analysis", "report_integration")
        workflow.add_edge("report_integration", END)
        
        return workflow.compile()
```

---

## 5. æ•°æ®æµæ¶æ„è®¾è®¡

### 5.1 å®Œæ•´æ•°æ®æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®è¾“å…¥å±‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”¨æˆ·è¾“å…¥: ticker="000001", analysis_date="2024-12-31"       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•°æ®éªŒè¯ä¸é¢„å¤„ç†                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Aè‚¡ä»£ç æ ¼å¼éªŒè¯ (6ä½æ•°å­—)                                   â”‚
â”‚  â€¢ äº¤æ˜“æ—¥æœŸæœ‰æ•ˆæ€§éªŒè¯                                         â”‚
â”‚  â€¢ å…¬å¸åŸºæœ¬ä¿¡æ¯æŸ¥è¯¢                                           â”‚
â”‚  â€¢ è¡Œä¸šåˆ†ç±»ä¿¡æ¯è·å–                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å¤šæºæ•°æ®å¹¶è¡Œè·å–                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   è´¢åŠ¡æ•°æ®æº     â”‚  â”‚   è¡Œä¸šæ•°æ®æº     â”‚  â”‚   å¸‚åœºæ•°æ®æº     â”‚â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚â”‚
â”‚  â”‚ â€¢ Tushare       â”‚  â”‚ â€¢ è¯ç›‘ä¼šè¡Œä¸šåˆ†ç±» â”‚  â”‚ â€¢ å®æ—¶è‚¡ä»·æ•°æ®   â”‚â”‚
â”‚  â”‚   - èµ„äº§è´Ÿå€ºè¡¨   â”‚  â”‚ â€¢ åŒè¡Œä¸šå…¬å¸åˆ—è¡¨ â”‚  â”‚ â€¢ è‚¡ä¸œå˜åŠ¨æ•°æ®   â”‚â”‚
â”‚  â”‚   - åˆ©æ¶¦è¡¨       â”‚  â”‚ â€¢ è¡Œä¸šå¹³å‡æŒ‡æ ‡   â”‚  â”‚ â€¢ æœºæ„æŒä»“æ•°æ®   â”‚â”‚
â”‚  â”‚   - ç°é‡‘æµé‡è¡¨   â”‚  â”‚ â€¢ é¾™å¤´ä¼ä¸šæ•°æ®   â”‚  â”‚ â€¢ ä¼°å€¼æŒ‡æ ‡      â”‚â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚â”‚
â”‚  â”‚ â€¢ AkShare (å¤‡ç”¨) â”‚  â”‚ â€¢ Wind (å¤‡ç”¨)   â”‚  â”‚ â€¢ Yahoo (å¤‡ç”¨)  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•°æ®æ¸…æ´—ä¸æ ‡å‡†åŒ–                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ æ•°æ®å®Œæ•´æ€§æ£€æŸ¥                                             â”‚
â”‚  â€¢ å¼‚å¸¸å€¼æ£€æµ‹ä¸å¤„ç†                                           â”‚
â”‚  â€¢ æ•°æ®æ ¼å¼ç»Ÿä¸€                                               â”‚
â”‚  â€¢ ç¼ºå¤±å€¼æ’å€¼è¡¥å…¨                                             â”‚
â”‚  â€¢ è´¢åŠ¡æŒ‡æ ‡è®¡ç®—                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç¼“å­˜å±‚å­˜å‚¨                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   Redisç¼“å­˜     â”‚  â”‚   MongoDBå­˜å‚¨   â”‚  â”‚   æ–‡ä»¶ç¼“å­˜       â”‚â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚â”‚
â”‚  â”‚ â€¢ çƒ­ç‚¹æ•°æ®       â”‚  â”‚ â€¢ åŸå§‹è´¢åŠ¡æ•°æ®   â”‚  â”‚ â€¢ å¤§æ•°æ®é›†       â”‚â”‚
â”‚  â”‚ â€¢ è®¡ç®—ç»“æœ       â”‚  â”‚ â€¢ åˆ†æå†å²è®°å½•   â”‚  â”‚ â€¢ è¡Œä¸šæ•°æ®       â”‚â”‚
â”‚  â”‚ â€¢ ä¼šè¯çŠ¶æ€       â”‚  â”‚ â€¢ ç”¨æˆ·é…ç½®       â”‚  â”‚ â€¢ å¤‡ä»½æ•°æ®       â”‚â”‚
â”‚  â”‚ TTL: 1å°æ—¶      â”‚  â”‚ æŒä¹…åŒ–å­˜å‚¨       â”‚  â”‚ é•¿æœŸç¼“å­˜         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 æ•°æ®æºé…ç½®ç­–ç•¥
```python
ASHARE_DATA_SOURCES = {
    "financial_data": {
        "primary": "tushare",
        "fallback": ["akshare", "wind"], 
        "cache_ttl": 3600,
        "retry_count": 3,
        "timeout": 30
    },
    "industry_data": {
        "primary": "csrc_classification",
        "fallback": ["sw_classification"],
        "cache_ttl": 86400,  # 24å°æ—¶
        "retry_count": 2
    },
    "market_data": {
        "primary": "tushare",
        "fallback": ["akshare", "yahoo"],
        "cache_ttl": 300,    # 5åˆ†é’Ÿ
        "retry_count": 3
    }
}
```

---

## 6. æ¥å£è®¾è®¡

### 6.1 ä¸ç°æœ‰ç³»ç»Ÿé›†æˆ
```python
# åœ¨tradingagents/graph/trading_graph.pyä¸­æ‰©å±•
class TradingAgentsGraph:
    def __init__(self, ...):
        # ç°æœ‰åˆå§‹åŒ–ä»£ç 
        
        # æ–°å¢Aè‚¡åˆ†æå›¾æ”¯æŒ
        self.ashare_graph = None
        if self.config.get("ashare_analysis", {}).get("enabled", False):
            self.ashare_graph = AShareAnalysisGraph(
                llm=self.deep_thinking_llm,
                config=self.config,
                toolkit=self.toolkit
            )
    
    def analyze_ashare_stock(self, ticker: str, analysis_date: str = None) -> Dict:
        """Aè‚¡åˆ†ææ–°æ¥å£"""
        if not self.ashare_graph:
            raise ValueError("Aè‚¡åˆ†æåŠŸèƒ½æœªå¯ç”¨")
        
        return self.ashare_graph.analyze(ticker, analysis_date)
```

### 6.2 Streamlit Webç•Œé¢é›†æˆ
```python
class AShareAnalysisComponent:
    def render(self):
        st.subheader("ğŸ‡¨ğŸ‡³ Aè‚¡æ·±åº¦åˆ†æ")
        
        # åˆ›å»ºä¸¤åˆ—å¸ƒå±€
        col1, col2 = st.columns([2, 1])
        
        with col1:
            ticker = st.text_input(
                "è¯·è¾“å…¥Aè‚¡ä»£ç ", 
                placeholder="ä¾‹å¦‚: 000001, 600036, 300015",
                help="æ”¯æŒ6ä½Aè‚¡ä»£ç "
            )
            
        with col2:
            analysis_depth = st.selectbox(
                "åˆ†ææ·±åº¦",
                ["æ ‡å‡†åˆ†æ", "æ·±åº¦åˆ†æ", "å¿«é€Ÿåˆ†æ"],
                index=0
            )
        
        # åˆ†æé€‰é¡¹
        with st.expander("é«˜çº§é€‰é¡¹"):
            col3, col4 = st.columns(2)
            with col3:
                enable_financial = st.checkbox("è´¢åŠ¡æŒ‡æ ‡åˆ†æ", value=True)
                enable_industry = st.checkbox("è¡Œä¸šå¯¹æ¯”åˆ†æ", value=True)
            with col4:
                enable_valuation = st.checkbox("ä¼°å€¼åˆ†æ", value=True)
                enable_integration = st.checkbox("ç»¼åˆæŠ¥å‘Š", value=True)
        
        # åˆ†ææŒ‰é’®
        if st.button("å¼€å§‹åˆ†æ", type="primary"):
            if not ticker:
                st.error("è¯·è¾“å…¥è‚¡ç¥¨ä»£ç ")
                return
            
            # éªŒè¯Aè‚¡ä»£ç æ ¼å¼
            if not self._validate_ashare_ticker(ticker):
                st.error("è¯·è¾“å…¥æ­£ç¡®çš„Aè‚¡ä»£ç æ ¼å¼")
                return
            
            # æ‰§è¡Œåˆ†æ
            with st.spinner("æ­£åœ¨åˆ†æä¸­..."):
                try:
                    result = self.graph.analyze_ashare_stock(ticker)
                    self._display_results(result)
                except Exception as e:
                    st.error(f"åˆ†æå¤±è´¥: {str(e)}")
```

### 6.3 CLIæ¥å£æ‰©å±•
```python
@cli_app.command()
def ashare_analysis(
    ticker: str = typer.Argument(..., help="Aè‚¡ä»£ç "),
    output: str = typer.Option("console", help="è¾“å‡ºæ ¼å¼: console/json/pdf"),
    depth: str = typer.Option("standard", help="åˆ†ææ·±åº¦: quick/standard/deep")
):
    """Aè‚¡æ·±åº¦åˆ†æ"""
    try:
        # åˆå§‹åŒ–åˆ†æå›¾
        graph = TradingAgentsGraph(config=load_config())
        
        # æ‰§è¡Œåˆ†æ
        result = graph.analyze_ashare_stock(ticker)
        
        # è¾“å‡ºç»“æœ
        if output == "console":
            display_console_result(result)
        elif output == "json":
            print(json.dumps(result, ensure_ascii=False, indent=2))
        elif output == "pdf":
            generate_pdf_report(result, f"ashare_analysis_{ticker}.pdf")
            
    except Exception as e:
        typer.echo(f"é”™è¯¯: {str(e)}", err=True)
        raise typer.Exit(1)
```

---

## 7. æ€§èƒ½ä¼˜åŒ–è®¾è®¡

### 7.1 å¤šå±‚ç¼“å­˜ç­–ç•¥
```python
class AShareCacheManager:
    """Aè‚¡åˆ†æä¸“ç”¨ç¼“å­˜ç®¡ç†å™¨"""
    
    def __init__(self):
        self.redis_cache = RedisCache(ttl=3600)      # 1å°æ—¶çƒ­ç¼“å­˜
        self.mongodb_cache = MongoCache(ttl=86400)   # 24å°æ—¶æ¸©ç¼“å­˜
        self.file_cache = FileCache(ttl=604800)      # 7å¤©å†·ç¼“å­˜
    
    def get_financial_data(self, ticker: str, years: int = 3) -> Dict:
        """æ™ºèƒ½ç¼“å­˜è·å–è´¢åŠ¡æ•°æ®"""
        cache_key = f"financial:{ticker}:{years}"
        
        # L1: Redisçƒ­ç¼“å­˜
        data = self.redis_cache.get(cache_key)
        if data:
            return data
        
        # L2: MongoDBæ¸©ç¼“å­˜  
        data = self.mongodb_cache.get(cache_key)
        if data:
            self.redis_cache.set(cache_key, data)
            return data
        
        # L3: æ–‡ä»¶å†·ç¼“å­˜
        data = self.file_cache.get(cache_key)
        if data:
            self.mongodb_cache.set(cache_key, data)
            self.redis_cache.set(cache_key, data)
            return data
        
        # ç¼“å­˜æœªå‘½ä¸­ï¼Œä»æ•°æ®æºè·å–
        data = self._fetch_from_source(ticker, years)
        self._cache_all_levels(cache_key, data)
        return data
```

### 7.2 å¹¶å‘å¤„ç†ä¼˜åŒ–
```python
class AShareAnalysisGraph:
    async def analyze_concurrent(self, ticker: str) -> Dict:
        """å¹¶å‘æ‰§è¡Œåˆ†æä»»åŠ¡"""
        
        # æ•°æ®é¢„å–é˜¶æ®µ - å¹¶è¡Œè·å–
        data_tasks = [
            self._fetch_financial_data(ticker),
            self._fetch_industry_data(ticker), 
            self._fetch_market_data(ticker)
        ]
        
        financial_data, industry_data, market_data = await asyncio.gather(*data_tasks)
        
        # Agentåˆ†æé˜¶æ®µ - å¹¶è¡Œæ‰§è¡Œ
        analysis_tasks = [
            self.financial_agent.analyze(financial_data),
            self.industry_agent.analyze(industry_data)
        ]
        
        financial_result, industry_result = await asyncio.gather(*analysis_tasks)
        
        # ä¼°å€¼åˆ†æ - ä¾èµ–å‰é¢ç»“æœ
        valuation_result = await self.valuation_agent.analyze(
            financial_result, industry_result, market_data
        )
        
        # æŠ¥å‘Šæ•´åˆ - æœ€ç»ˆæ­¥éª¤
        final_report = await self.integration_agent.analyze(
            financial_result, industry_result, valuation_result
        )
        
        return final_report
```

### 7.3 LLMè°ƒç”¨ä¼˜åŒ–
```python
class LLMOptimizer:
    """LLMè°ƒç”¨æˆæœ¬å’Œæ€§èƒ½ä¼˜åŒ–"""
    
    def optimize_prompt(self, agent_type: str, data: Dict) -> str:
        """ä¼˜åŒ–æç¤ºè¯é•¿åº¦"""
        # æ•°æ®æ‘˜è¦åŒ–
        summarized_data = self._summarize_data(data, max_tokens=2000)
        
        # æ¨¡æ¿åŒ–æç¤ºè¯
        template = self._get_prompt_template(agent_type)
        
        return template.format(data=summarized_data)
    
    def batch_analyze(self, prompts: List[str]) -> List[str]:
        """æ‰¹é‡å¤„ç†ä¼˜åŒ–"""
        # åˆå¹¶ç›¸ä¼¼åˆ†æä»»åŠ¡
        batched_prompts = self._merge_similar_prompts(prompts)
        
        # å¹¶å‘è°ƒç”¨
        results = []
        for batch in batched_prompts:
            batch_result = self.llm.batch_invoke(batch)
            results.extend(batch_result)
        
        return results
```

---

## 8. é…ç½®ç®¡ç†è®¾è®¡

### 8.1 é…ç½®ç»“æ„
```python
# åœ¨tradingagents/default_config.pyä¸­æ‰©å±•
ASHARE_ANALYSIS_CONFIG = {
    "enabled": True,
    "version": "1.0.0",
    
    # Agenté…ç½®
    "agents": {
        "financial_metrics": {
            "enabled": True,
            "analysis_depth": "comprehensive",
            "lookback_years": 3,
            "health_score_weights": {
                "roe": 0.3,
                "debt_ratio": 0.25,
                "cash_flow": 0.25,
                "dividend": 0.2
            }
        },
        "industry_comparison": {
            "enabled": True,
            "comparison_method": "both",
            "leader_count": 3,
            "industry_classification": "csrc",  # è¯ç›‘ä¼šåˆ†ç±»
        },
        "valuation_analysis": {
            "enabled": True,
            "valuation_methods": ["peg", "pb", "ps", "ev_ebitda"],
            "price_target_confidence": 0.8,
            "abnormal_change_threshold": 0.05,  # 5%å¼‚å¸¸å˜åŠ¨é˜ˆå€¼
        },
        "report_integration": {
            "enabled": True,
            "report_format": "pyramid",
            "language": "chinese",
            "scoring_weights": {
                "financial_health": 0.4,
                "industry_position": 0.3,
                "valuation_reasonable": 0.2,
                "market_signals": 0.1
            }
        }
    },
    
    # æ•°æ®æºé…ç½®
    "data_sources": {
        "financial": {
            "primary": "tushare",
            "fallback": ["akshare"],
            "cache_ttl": 3600,
            "retry_count": 3
        },
        "industry": {
            "primary": "csrc_classification", 
            "fallback": ["sw_classification"],
            "cache_ttl": 86400
        }
    },
    
    # æ€§èƒ½é…ç½®
    "performance": {
        "max_concurrent_analysis": 5,
        "llm_batch_size": 3,
        "cache_strategy": "multi_layer",
        "timeout_seconds": 120
    }
}

# åˆå¹¶åˆ°ä¸»é…ç½®
DEFAULT_CONFIG.update({"ashare_analysis": ASHARE_ANALYSIS_CONFIG})
```

---

## 9. å®Œæ•´ç›®å½•ç»“æ„

```
tradingagents/
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ a_share_analysts/           # æ–°å¢Aè‚¡åˆ†ææ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base_ashare_analyst.py
â”‚   â”‚   â”œâ”€â”€ financial_metrics_agent.py
â”‚   â”‚   â”œâ”€â”€ industry_comparison_agent.py  
â”‚   â”‚   â”œâ”€â”€ valuation_analysis_agent.py
â”‚   â”‚   â””â”€â”€ report_integration_agent.py
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ ashare_states.py        # Aè‚¡åˆ†æçŠ¶æ€å®šä¹‰
â”œâ”€â”€ dataflows/
â”‚   â””â”€â”€ ashare_data/               # Aè‚¡æ•°æ®å¤„ç†æ¨¡å—
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ ashare_data_manager.py
â”‚       â”œâ”€â”€ financial_processor.py
â”‚       â”œâ”€â”€ industry_processor.py
â”‚       â””â”€â”€ valuation_processor.py
â”œâ”€â”€ graph/
â”‚   â””â”€â”€ ashare_analysis_graph.py   # Aè‚¡åˆ†æå›¾ç»“æ„
â”œâ”€â”€ tools/
â”‚   â””â”€â”€ ashare_tools/              # Aè‚¡ä¸“ç”¨å·¥å…·
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ financial_tools.py
â”‚       â”œâ”€â”€ industry_tools.py
â”‚       â””â”€â”€ valuation_tools.py
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ ashare_utils/              # Aè‚¡åˆ†æå·¥å…·
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ calculator.py
â”‚       â”œâ”€â”€ classifier.py
â”‚       â”œâ”€â”€ report_generator.py
â”‚       â””â”€â”€ cache_manager.py
â””â”€â”€ config/
    â””â”€â”€ ashare_config.py           # Aè‚¡åˆ†æé…ç½®

web/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ ashare_analysis.py         # Aè‚¡åˆ†æUIç»„ä»¶
â””â”€â”€ utils/
    â””â”€â”€ ashare_results_display.py  # ç»“æœå±•ç¤ºç»„ä»¶

tests/
â””â”€â”€ ashare/                        # Aè‚¡åˆ†ææµ‹è¯•
    â”œâ”€â”€ test_financial_agent.py
    â”œâ”€â”€ test_industry_agent.py
    â”œâ”€â”€ test_valuation_agent.py
    â””â”€â”€ test_integration_agent.py
```

---

## 10. å®æ–½è·¯å¾„

### 10.1 å¼€å‘é˜¶æ®µè§„åˆ’

#### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„æ­å»º (2å‘¨)
**ç›®æ ‡**ï¼šå®Œæˆæ ¸å¿ƒAgentæ¶æ„è®¾è®¡
**äº¤ä»˜ç‰©**ï¼š
- Aè‚¡åˆ†æAgentåŸºç±»å®ç°
- æ•°æ®æºé€‚é…å™¨å®ç°  
- åŸºç¡€é…ç½®ç³»ç»Ÿæ‰©å±•
**é‡Œç¨‹ç¢‘**ï¼šåŸºç¡€æ¡†æ¶å¯è¿è¡Œ

#### ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒAgentå¼€å‘ (4å‘¨)
**ç›®æ ‡**ï¼šå®ç°å››ä¸ªæ ¸å¿ƒåˆ†æAgent
**äº¤ä»˜ç‰©**ï¼š
- è´¢åŠ¡æŒ‡æ ‡åˆ†æAgent
- è¡Œä¸šå¯¹æ¯”åˆ†æAgent
- ä¼°å€¼åˆ†æAgent
- ä¿¡æ¯æ•´åˆAgent
**é‡Œç¨‹ç¢‘**ï¼šå•ä¸ªAgentåŠŸèƒ½å®Œæ•´

#### ç¬¬ä¸‰é˜¶æ®µï¼šç³»ç»Ÿé›†æˆæµ‹è¯• (2å‘¨)
**ç›®æ ‡**ï¼šå®Œæˆå¤šAgentåä½œé›†æˆ
**äº¤ä»˜ç‰©**ï¼š
- Agentåä½œæµç¨‹å®ç°
- é”™è¯¯å¤„ç†æœºåˆ¶å®Œå–„
- æ€§èƒ½ä¼˜åŒ–è°ƒæ•´
**é‡Œç¨‹ç¢‘**ï¼šç«¯åˆ°ç«¯æµç¨‹å¯ç”¨

#### ç¬¬å››é˜¶æ®µï¼šç”¨æˆ·ç•Œé¢å¼€å‘ (2å‘¨)
**ç›®æ ‡**ï¼šå®Œæˆç”¨æˆ·äº¤äº’ç•Œé¢
**äº¤ä»˜ç‰©**ï¼š
- Webç•Œé¢æ‰©å±•
- ç»“æœå±•ç¤ºä¼˜åŒ–
- ç§»åŠ¨ç«¯é€‚é…
**é‡Œç¨‹ç¢‘**ï¼šç”¨æˆ·å¯å®Œæ•´ä½¿ç”¨

#### ç¬¬äº”é˜¶æ®µï¼šæµ‹è¯•ä¸å‘å¸ƒ (2å‘¨)
**ç›®æ ‡**ï¼šå®Œæˆå…¨é¢æµ‹è¯•å’Œéƒ¨ç½²
**äº¤ä»˜ç‰©**ï¼š
- ç³»ç»Ÿæµ‹è¯•æŠ¥å‘Š
- ç”¨æˆ·æ¥å—æµ‹è¯•
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
**é‡Œç¨‹ç¢‘**ï¼šæ­£å¼å‘å¸ƒä¸Šçº¿

### 10.2 å¼€å‘æŒ‡å¯¼åŸåˆ™

1. **å‘åå…¼å®¹**ï¼šç¡®ä¿ä¸å½±å“ç°æœ‰TradingAgents-CNåŠŸèƒ½
2. **æ¨¡å—åŒ–å¼€å‘**ï¼šæ¯ä¸ªAgentå¯ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•
3. **å¢é‡äº¤ä»˜**ï¼šæ¯ä¸ªé˜¶æ®µéƒ½æœ‰å¯è¿è¡Œçš„ç‰ˆæœ¬
4. **è´¨é‡ä¼˜å…ˆ**ï¼šå®Œå–„çš„æµ‹è¯•è¦†ç›–å’Œä»£ç å®¡æŸ¥
5. **æ–‡æ¡£åŒæ­¥**ï¼šä»£ç å’Œæ–‡æ¡£åŒæ­¥æ›´æ–°

---

## 11. é£é™©è¯„ä¼°ä¸ç¼“è§£

### 11.1 æŠ€æœ¯é£é™©
- **æ•°æ®æºä¾èµ–é£é™©**ï¼šå®ç°å¤šæ•°æ®æºçƒ­åˆ‡æ¢æœºåˆ¶
- **LLMæœåŠ¡ç¨³å®šæ€§é£é™©**ï¼šéƒ¨ç½²å¤šå®ä¾‹è´Ÿè½½å‡è¡¡
- **æ€§èƒ½ç“¶é¢ˆé£é™©**ï¼šå®æ–½åˆ†å¸ƒå¼ç¼“å­˜ç­–ç•¥

### 11.2 ä¸šåŠ¡é£é™©
- **åˆ†æå‡†ç¡®æ€§é£é™©**ï¼šå»ºç«‹å¤šå±‚éªŒè¯æœºåˆ¶
- **åˆè§„é£é™©**ï¼šæ˜ç¡®å®šä½ä¸º"åˆ†æå·¥å…·"
- **ç”¨æˆ·æ¥å—åº¦é£é™©**ï¼šæä¾›è¯¦ç»†çš„åˆ†æé€»è¾‘è¯´æ˜

---

## 12. æ€»ç»“

æœ¬æ¶æ„è®¾è®¡æä¾›äº†å®Œæ•´çš„Aè‚¡åˆ†æå¤šæ™ºèƒ½ä½“ç³»ç»ŸæŠ€æœ¯æ–¹æ¡ˆï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **å®Œæ•´æ€§**ï¼šè¦†ç›–ä»æ•°æ®è·å–åˆ°æŠ¥å‘Šç”Ÿæˆçš„å…¨æµç¨‹
2. **å¯æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡æ”¯æŒæœªæ¥åŠŸèƒ½æ‰©å±•
3. **é«˜æ€§èƒ½**ï¼šå¤šå±‚ç¼“å­˜å’Œå¹¶å‘å¤„ç†ä¼˜åŒ–
4. **æ˜“ç»´æŠ¤**ï¼šæ¸…æ™°çš„ä»£ç ç»„ç»‡å’Œæ–‡æ¡£
5. **å‘åå…¼å®¹**ï¼šæ— ç¼é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ

è¯¥æ¶æ„è®¾è®¡ä¸ºAè‚¡åˆ†æå¤šæ™ºèƒ½ä½“ç³»ç»Ÿçš„å¼€å‘æä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ï¼Œç¡®ä¿é¡¹ç›®èƒ½å¤Ÿé«˜è´¨é‡åœ°äº¤ä»˜å¹¶ä¸ºæœªæ¥æ‰©å±•å¥ å®šåŸºç¡€ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-08-02  
**æ–‡æ¡£ç±»å‹**: æŠ€æœ¯æ¶æ„è®¾è®¡  
**é€‚ç”¨é¡¹ç›®**: TradingAgents-CN Aè‚¡åˆ†ææ‰©å±•